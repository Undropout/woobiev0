<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pick Your Woobie Name</title>
  <link rel="stylesheet" href="../shared/style.css" />
</head>
<body class="normal-mode">
  <div class="container">
    <h1>ğŸ² Pick Your Woobie Name ğŸ²</h1>

    <!-- Welcome explanation -->
    <div style="background-color: #1a1a1a; border: 1px solid #33ff33; border-radius: 6px; padding: 1.25rem; margin-bottom: 2rem; text-align: center;">
      <p style="margin-bottom: 0.75rem; line-height: 1.8;">
        Welcome! We anonymize everyone with fun Woobie names to keep things light and mysterious at first. Don't worry - you'll share as much or as little as you want with your match later.
      </p>
      <p style="margin-bottom: 0; line-height: 1.8; color: #00ffff;">
        For now, pick a name that makes you smile! Try clicking the different modes below to see what the generator creates for you.
      </p>
    </div>

    <div id="mode-buttons">
      <button data-mode="normal" class="woobie-button">Normal</button>
      <button data-mode="prismatic" class="woobie-button premium">Prismatic âœ¨</button>
      <button data-mode="neon" class="woobie-button premium">Neon ğŸ’¡</button>
      <button data-mode="cosmic" class="woobie-button premium">Cosmic ğŸŒŒ</button>
    </div>

    <div id="name-options" class="option-grid"></div>

    <!-- Centered Reroll Button -->
    <div style="text-align: center; margin: 1.5rem 0;">
      <button id="reroll" class="woobie-button" style="font-size: 1.1rem; padding: 0.75rem 2rem;">ğŸ° Reroll ğŸ°</button>
    </div>

    <p id="selected-name" style="text-align: center; font-size: 1.1rem; margin: 1rem 0;"></p>

    <!-- Larger, Centered "This is me" Button -->
    <div style="text-align: center; margin: 1.5rem 0;">
      <button id="confirm" class="woobie-button" style="font-size: 1.3rem; padding: 1rem 3rem; background-color: #1a4d1a; border: 2px solid #33ff33;">âœ… This is me</button>
    </div>

    <!-- Referral Code Section (hidden by default, less prominent) -->
    <div id="referral-section" style="display:none; margin-top: 3rem; padding: 0.5rem; border: 1px solid #444; border-radius: 5px; opacity: 0.6;">
      <details>
        <summary style="color: #777; cursor: pointer; padding: 0.5rem; font-size: 0.9rem;">Optional: Match with a specific friend</summary>
        <div style="margin-top: 1rem;">
          <button id="generate-code-btn" class="woobie-button" style="font-size: 0.9rem;">ğŸ”— Generate Code</button>
          <button id="enter-code-btn" class="woobie-button" style="font-size: 0.9rem;">ğŸ”‘ Enter Code</button>

          <!-- Code generation result -->
          <div id="code-result" style="display:none; margin-top: 1rem;">
            <p style="color: #00ffff;">Your friend code:</p>
            <p id="generated-code" style="color: #33ff33; font-size: 1.2rem; font-weight: bold;"></p>
            <button id="copy-code-btn" class="woobie-button">ğŸ“‹ Copy Code</button>
            <button id="proceed-with-code-btn" class="woobie-button">âœ… Proceed</button>
          </div>

          <!-- Code entry form -->
          <div id="code-entry" style="display:none; margin-top: 1rem;">
            <label for="friend-code-input" style="color: #00ffff;">Enter your friend's code:</label>
            <input type="text" id="friend-code-input" style="width: 100%; padding: 0.5rem; margin-top: 0.5rem; background: #000; border: 2px solid #33ff33; color: #33ff33;" placeholder="purple-cosmic-dolphin">
            <button id="validate-code-btn" class="woobie-button" style="margin-top: 0.5rem;">âœ… Validate</button>
            <button id="cancel-entry-btn" class="woobie-button" style="margin-top: 0.5rem;">âŒ Cancel</button>
            <p id="validation-message" style="margin-top: 0.5rem;"></p>
          </div>
        </div>
      </details>
    </div>

    <!-- Main continue button (shown after "This is me") -->
    <div style="text-align: center; margin: 2rem 0;">
      <button id="continue-main-btn" class="woobie-button" style="display:none; font-size: 1.3rem; padding: 1rem 3rem; background-color: #1a4d1a; border: 2px solid #33ff33;">Begin Journey â†’</button>
    </div>

    <button id="logout-button" class="woobie-button" style="margin-top: 3rem; font-size: 0.85rem; opacity: 0.5; background-color: transparent; border: 1px solid #444;">ğŸšª Log out</button>
  </div>

  <script>
    // EXACT same function as your working chat version
    function replaceEmojiWithMonochrome(text) {
      return text.replace(/(\p{Emoji_Presentation}|\p{Emoji}\uFE0F)/gu, (match) => {
        return `<span class="woobie-emoji">${match}</span>`;
      });
    }

    // Apply to static elements (like chat does)
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        // Process static buttons first
        const staticElements = [
          document.querySelector('h1'),
          document.getElementById('reroll'),
          document.getElementById('confirm'), 
          document.getElementById('logout-button'),
          ...document.querySelectorAll('#mode-buttons button')
        ];
        
        staticElements.forEach(element => {
          if (element && element.textContent) {
            element.innerHTML = replaceEmojiWithMonochrome(element.textContent);
          }
        });
        
        console.log('âœ… Static emoji processing complete');
      }, 200);
    });

    // Watch for dynamic name buttons (like the MutationObserver in chat)
    const observer = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        mutation.addedNodes.forEach((node) => {
          if (node.nodeType === Node.ELEMENT_NODE && node.classList.contains('name-button')) {
            const strongTag = node.querySelector('strong');
            if (strongTag && strongTag.textContent) {
              strongTag.innerHTML = replaceEmojiWithMonochrome(strongTag.textContent);
            }
          }
        });
      });
    });

    // Start observing when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      const nameOptions = document.getElementById('name-options');
      if (nameOptions) {
        observer.observe(nameOptions, { childList: true, subtree: true });
      }
    });
  </script>

  <script type="module" src="./name-generator.js"></script>
  <script type="module" src="../shared/logout.js"></script>
  <script type="module" src="../shared/feedback.js"></script>
</body>
</html>