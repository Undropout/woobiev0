import{o as q,r as l,d as c,u as m,g as k,a as F,i as U,e as B}from"./firebase-config-C0024qU1.js";/* empty css              */import"./logout-q5yztgx1.js";const R=["Books","Gaming","Music","Art","Nature","Cooking","Fitness","Travel","Animals","Science","Tech","Movies"],P=["Racism","Homophobia","Conspiracies","Aggression","Unreliability","Boundary issues"];let g=new Set,h=new Set;const C=document.getElementById("interest-options"),E=document.getElementById("dealbreaker-options"),M=document.getElementById("gender-identity"),D=document.getElementById("looking-for-gender-options"),y=document.getElementById("continue-btn"),i=document.getElementById("message");let r=null,p=null,w=null,x=null;C.innerHTML="";E.innerHTML="";function S(t,e,o){const n=t.textContent;e.has(n)?(e.delete(n),t.classList.remove("selected")):e.size<o?(e.add(n),t.classList.add("selected")):(i.textContent=`You can select a maximum of ${o} items for this section.`,setTimeout(()=>i.textContent="",3e3))}R.forEach(t=>{const e=document.createElement("button");e.textContent=t,e.className="woobie-button",e.onclick=()=>S(e,g,6),C.appendChild(e)});P.forEach(t=>{const e=document.createElement("button");e.textContent=t,e.className="woobie-button",e.onclick=()=>S(e,h,3),E.appendChild(e)});const f=document.getElementById("lf_any"),I=D.querySelectorAll('input[type="checkbox"]:not(#lf_any)');f&&f.addEventListener("change",t=>{t.target.checked?I.forEach(e=>{e.checked=!1,e.disabled=!0}):I.forEach(e=>e.disabled=!1)});q(F,async t=>{if(t){if(r=t.uid,p=localStorage.getItem("woobieUsername"),w=localStorage.getItem("woobieMode"),x=localStorage.getItem("woobieEmoji"),!p||!w||!r){i.textContent="Critical session data missing (name, mode, or UID). Please start over from name picking.",setTimeout(()=>window.location.href="/name-picker/index.html",3e3),y.disabled=!0;return}try{const e=l(c,`users/${r}/currentMatch`);await m(e,{stage:"interests-dealbreakers"})}catch(e){console.error("Error updating user stage to interests-dealbreakers:",e)}try{const e=await k(l(c,`users/${r}/profileDetails`));if(e.exists()){const o=e.val();o.gender&&(M.value=o.gender),o.lookingForGender&&D.querySelectorAll('input[type="checkbox"]').forEach(s=>{o.lookingForGender.includes(s.value)&&(s.checked=!0,s.value==="any"&&I.forEach(a=>a.disabled=!0))}),o.interests&&(g=new Set(o.interests),C.querySelectorAll(".woobie-button").forEach(n=>{g.has(n.textContent)&&n.classList.add("selected")})),o.dealbreakers&&(h=new Set(o.dealbreakers),E.querySelectorAll(".woobie-button").forEach(n=>{h.has(n.textContent)&&n.classList.add("selected")}))}}catch(e){console.error("Error pre-filling preferences:",e),i.textContent="Could not load saved preferences. Please select them again."}}else i.textContent="You must be logged in. Redirecting to login...",setTimeout(()=>window.location.href="/auth/login.html",2e3),y.disabled=!0});y.onclick=async()=>{if(!r){i.textContent="Authentication error. Please log in again.";return}if(g.size<3){i.textContent="Please pick at least 3 interests.";return}const t=M.value;let e=[];if(f&&f.checked?e.push("any"):D.querySelectorAll('input[type="checkbox"]:checked').forEach(s=>{e.push(s.value)}),!f.checked&&e.length===0){i.textContent='Please select what gender of friend you are looking for, or choose "Any".';return}const o=[...g],n=[...h];try{const s=l(c,`users/${r}/profileDetails`);await m(s,{gender:t,lookingForGender:e,interests:o,dealbreakers:n}),console.log("User profile details saved for UID:",r);let a=localStorage.getItem("woobieMatchID");a||(a=`m-${Date.now()}-${Math.floor(Math.random()*1e3)}`,localStorage.setItem("woobieMatchID",a));const b=await k(l(c,`users/${r}/currentMatch`));b.exists()&&b.val().matchID?a=b.val().matchID:await m(l(c,`users/${r}/currentMatch`),{matchID:a}),localStorage.setItem("woobieMatchID",a);const d=(await k(l(c,`users/${r}`))).val(),v=d&&d.referralCodeID&&d.referralMode,A=l(c,`queue/${r}`),u={userUID:r,woobieName:p,mode:w,emoji:x,gender:t,lookingForGender:e,interests:o,dealbreakers:n,potentialMatchIDForUser:a,timestamp:U()};v&&(u.referralCodeID=d.referralCodeID,u.referralMode=d.referralMode,d.referralMode==="waiting"?u.waitingForReferral=!0:d.referralMode==="claiming"&&(u.claimingReferral=!0)),await B(A,u);const $=l(c,`users/${r}/currentMatch`);await m($,{stage:"waiting_in_queue",matchID:a,username:p}),console.log(`User ${r} added to queue with potentialMatchID: ${a}`),window.location.href="/interests-dealbreakers/waiting.html"}catch(s){console.error("Error saving preferences and adding to queue:",s),i.textContent="Error saving your preferences. Please try again."}};
