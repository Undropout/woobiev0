const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/preload-helper-DX5QSOJm.js","assets/firebase-config-DqIMhm9h.js"])))=>i.map(i=>d[i]);
import{a as P,r as m,d,b as _,u as x}from"./firebase-config-DqIMhm9h.js";/* empty css              */import{_ as f}from"./preload-helper-DX5QSOJm.js";import"./logout-C5vuDOMp.js";function B(e){return e.replace(new RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),i=>`<span class="woobie-emoji">${i}</span>`)}document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("h1");e.innerHTML=B(e.textContent);const i=document.getElementById("submit-bio");i.innerHTML='Submit <span class="woobie-emoji">â†’</span>'});const h=document.getElementById("bio-input"),C=document.getElementById("bio-count"),t=document.getElementById("bio-warning"),a=document.getElementById("submit-bio");h.addEventListener("input",()=>{const e=h.value.trim().split(/\s+/).filter(Boolean);C.textContent=`${e.length} / 250 words`,e.length>250?(t.textContent="Too many words! Please stay under 250.",a.disabled=!0):(t.textContent="",a.disabled=!1)});a.onclick=async()=>{const e=h.value.trim(),i=e.split(/\s+/).filter(Boolean),p=/(.)\1{20,}/.test(e);if(i.length>250||p){t.textContent="Please shorten your bio and avoid repeated characters.";return}const r=P.currentUser;if(!r){t.textContent="You're not logged in. Please log in again.";return}a.disabled=!0,t.textContent="Submitting...",t.style.color="#33ff33";try{let o=localStorage.getItem("woobieMatchID");if(!o){const{get:n}=await f(async()=>{const{get:I}=await import("./preload-helper-DX5QSOJm.js").then(D=>D.i);return{get:I}},__vite__mapDeps([0,1])),s=(await n(m(d,`users/${r.uid}/currentMatch`))).val();if(!s||!s.matchID){t.textContent="No match found. Please restart from the beginning.",t.style.color="#ff6666",a.disabled=!1;return}o=s.matchID,localStorage.setItem("woobieMatchID",o),s.username&&localStorage.setItem("woobieUsername",s.username)}localStorage.setItem("woobieBio",e);const{get:w}=await f(async()=>{const{get:n}=await import("./preload-helper-DX5QSOJm.js").then(u=>u.i);return{get:n}},__vite__mapDeps([0,1])),y=m(d,`matches/${o}/users`),c=(await w(y)).val();if(console.log("[Bio Debug] Match ID:",o),console.log("[Bio Debug] Current User UID:",r.uid),console.log("[Bio Debug] Match users:",c),console.log("[Bio Debug] User in match?",c&&c.hasOwnProperty(r.uid)),!c||!c.hasOwnProperty(r.uid)){t.textContent=`Error: You're not registered in this match (${o}). Please contact support.`,t.style.color="#ff6666",a.disabled=!1,console.error("[Bio Debug] User not found in match users node");return}const E=m(d,`matches/${o}/bios/${r.uid}`),g=3;let l=0,b=null;for(;l<g;)try{await r.getIdToken(!0),await _(E,e);const n=m(d,`users/${r.uid}/currentMatch`);await x(n,{stage:"tier1a"}),window.location.href="/tier1a/index.html";return}catch(n){if(b=n,n.code==="PERMISSION_DENIED"&&l<g-1){const u=1e3*Math.pow(2,l);t.textContent=`Setting up permissions... (${l+1}/${g})`,await new Promise(s=>setTimeout(s,u)),l++}else throw n}throw b}catch(o){console.error("Error submitting bio:",o),t.textContent="Error submitting bio. Please try again.",t.style.color="#ff6666",a.disabled=!1}};
