import{s as C,a as L,o as $,u as R,r as i,d,g as S,c as I,e as E,b as M}from"./firebase-config-DqIMhm9h.js";/* empty css              */import"./logout-C5vuDOMp.js";function s(t){return t.replace(new RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),e=>`<span class="woobie-emoji">${e}</span>`)}document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector("h1");t.innerHTML=s(t.textContent);const e=document.getElementById("logout-button");e.innerHTML=s(e.textContent);const o=document.getElementById("vote-yes"),n=document.getElementById("vote-no");o.innerHTML=s(o.textContent),n.innerHTML=s(n.textContent);const c=document.getElementById("close-story");c.innerHTML=s(c.textContent);const r=document.querySelector("#our-story-modal h2");r.innerHTML=s(r.textContent);const u=document.getElementById("our-story-button");u.innerHTML=s(u.textContent)});const U=document.getElementById("logout-button");U.onclick=async()=>{if(confirm("Are you sure you want to log out? You'll lose your place unless you're logged in.")){try{await C(L)}catch(e){console.warn("Firebase sign-out failed:",e)}localStorage.clear(),sessionStorage.clear(),window.location.href="/index.html"}};const m=localStorage.getItem("woobieMatchID"),f=document.getElementById("reward-box"),x=document.getElementById("vote-yes"),T=document.getElementById("vote-no"),j=document.getElementById("vote-section"),F=document.getElementById("vote-waiting");let a=null;function w(t){let e="";t.text&&(e+=`<h3>üìù Message</h3><p style="white-space:pre-line;">${t.text}</p>`),t.imageURL&&(e+=`<h3>üñºÔ∏è Image</h3><img src="${t.imageURL}" alt="${t.alt||"Image from your match"}" style="max-width:100%; border:1px solid #33ff33;" />`),t.audioURL&&(e+=`<h3>üîä Voice Message</h3><audio controls src="${t.audioURL}"></audio>`);const o=s(e);f.innerHTML=o||"<p>Your match sent an empty reward.</p>",j.style.display="block"}async function V(){if(a)try{const t=i(d,`matches/${m}/tier2Rewards`),o=(await S(t)).val(),n=o?Object.keys(o).find(r=>r!==a):null,c=n?o[n]:null;if(n&&c)w(c);else{f.innerHTML="<p>Your match has not submitted a reward yet. Waiting...</p>";const r=I(t,u=>{const y=u.val(),g=y?Object.keys(y).find(k=>k!==a):null,p=g?y[g]:null;g&&p&&(w(p),E(t,r))})}}catch(t){f.innerHTML='<p style="color:#ff6666;">Failed to load reward.</p>',console.error("Error loading reward:",t)}}let b=!1;function H(){if(x.style.display="none",T.style.display="none",F.style.display="block",!b){b=!0;const t=i(d,`matches/${m}/tier2Votes`),e=I(t,o=>{const n=o.val();if(!n||Object.keys(n).length<2)return;const c=Object.values(n).every(r=>r===!0);E(t,e),window.location.href=c?"/tier3/index.html":"/goodbye.html"})}}x.onclick=async()=>{if(a)try{const t=i(d,`matches/${m}/tier2Votes/${a}`);await M(t,!0),H()}catch(t){console.error("Error voting:",t),alert("Failed to submit vote. Please try again.")}};T.onclick=async()=>{const t=prompt("If you're sure you want to end the match, type 'Goodbye' to confirm.");if((t==null?void 0:t.trim().toLowerCase())==="goodbye"){if(!a)return;try{const e=i(d,`matches/${m}/tier2Votes/${a}`);await M(e,!1),H()}catch(e){console.error("Error voting:",e),alert("Failed to submit vote. Please try again.")}}};$(L,async t=>{t?(a=t.uid,localStorage.getItem("woobieUsername"),await R(i(d,`users/${t.uid}/currentMatch`),{stage:"tier2-reveal"}),V()):window.location.href="/auth/login.html"});const v=document.getElementById("our-story-button"),B=document.getElementById("close-story"),l=document.getElementById("story-content"),h=document.getElementById("our-story-modal");v&&h&&l&&B&&(v.onclick=async()=>{h.style.display="block",l.innerHTML="<p>Loading...</p>";try{const t=document.createElement("iframe");t.src="/shared/history.html",t.style.width="100%",t.style.height="70vh",t.style.border="1px solid #33ff33",t.style.backgroundColor="black",l.innerHTML="",l.appendChild(t)}catch(t){console.error(t),l.innerHTML='<p style="color:red;">Error loading story.</p>'}},B.onclick=()=>{h.style.display="none"});
