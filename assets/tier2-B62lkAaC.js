import{s as M,a as h,o as p,g,r as c,u as f,d as u,c as k,b as w,e as S}from"./firebase-config-DqIMhm9h.js";/* empty css              */import"./logout-C5vuDOMp.js";function x(e){return e.replace(new RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),o=>`<span class="woobie-emoji">${o}</span>`)}document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("h1");e.innerHTML=x(e.textContent);const o=document.getElementById("logout-button");o.innerHTML=x(o.textContent)});const q=document.getElementById("logout-button");q.onclick=async()=>{if(confirm("Are you sure you want to log out? You'll lose your place unless you're logged in.")){try{await M(h)}catch(o){console.warn("Firebase sign-out failed:",o)}localStorage.clear(),sessionStorage.clear(),window.location.href="/resume.html"}};localStorage.getItem("woobieUsername");localStorage.getItem("woobieMatchID");const b=e=>c(u,`users/${e}/currentMatch`);p(h,async e=>{if(e){const n=(await g(b(e.uid))).val();(!n||!n.stage||n.stage==="tier1a")&&await f(b(e.uid),{stage:"tier2"})}});window.addEventListener("tier2Complete",()=>{p(h,async e=>{if(!e)return;const o=b(e.uid);await f(o,{stage:"tier2-complete"})})});const m=["What's a moment in your life that changed the way you see the world?","How do you show someone you care about them?","What's something people often misunderstand about you?","When do you feel most like yourself?","What's one thing you wish more people asked you about?","What makes you feel seen or understood?","What's a belief you held strongly that changed over time?","What's one thing you never get tired of talking about?","When have you felt the most brave?","What do you wish someone had told you earlier in life?","What kind of people do you feel safest around?","What's something you've forgiven yourself for?"];let l=[],s=0;p(h,e=>{if(!e){alert("You must be logged in to participate. Redirecting to login."),window.location.href="/auth/login.html";return}const o=e.uid;let n=localStorage.getItem("woobieMatchID"),r=localStorage.getItem("woobieUsername");if(!n||!r){g(c(u,`users/${o}/currentMatch`)).then(d=>{const i=d.val();if(!i||!i.matchID||!i.username){alert("No match found. Please restart."),window.location.href="/name-picker/index.html";return}n=i.matchID,r=i.username,localStorage.setItem("woobieMatchID",n),localStorage.setItem("woobieUsername",r),$(o,n,r)}).catch(d=>{console.error("Error fetching match data:",d),alert("Error loading session. Please try again.")});return}$(o,n,r)});async function $(e,o,n){console.log(`[Tier2 INIT] MatchID: ${o}, UserID: ${e}, WoobieName: ${n}`);const r=c(u,`users/${e}/currentMatch`);f(r,{stage:"tier2"});const d=c(u,`matches/${o}/tier2/${e}`),i=c(u,`matches/${o}/tier2`),I=c(u,`matches/${o}/tier2Rewards`),y=c(u,`matches/${o}/tier2Drafts/${e}`);try{if((await g(d)).exists()){console.log("[Tier2] User has already submitted answers, redirecting to send page"),window.location.href="/tier2/send.html";return}}catch(t){console.error("Error checking existing answers:",t)}try{const t=await g(y);if(t.exists()){const a=t.val();l=a.answers||[],s=a.currentIndex||0,console.log("[Tier2] Loaded partial draft from database:",{answerCount:l.length,currentIndex:s})}else console.log("[Tier2] No draft found in database, starting fresh")}catch(t){console.error("Error loading tier2 draft from database:",t)}function E(t){document.getElementById("question-number")&&(document.getElementById("question-number").textContent=`Question ${t+1} of ${m.length}`),document.getElementById("question-text")&&(document.getElementById("question-text").textContent=m[t]),document.getElementById("answer")&&(document.getElementById("answer").value=l[t]||"")}function T(){const t={answers:l,currentIndex:s,lastSaved:Date.now()};w(y,t).then(()=>{console.log("[Tier2] Saved draft to database:",{answerCount:l.length,currentIndex:s})}).catch(a=>{console.error("[Tier2] Error saving draft to database:",a)})}async function v(){try{await w(d,{answers:l,woobieName:n,timestamp:Date.now()}),console.log("Tier2 answers submitted successfully"),await w(y,null),console.log("Tier2 draft cleared from database"),await f(r,{stage:"tier2-answers-submitted"}),W()}catch(t){console.error("Error saving tier2 answers:",t),alert("Failed to save answers. Please try again.")}}function W(){k(i,t=>{const a=t.val()||{};Object.keys(a).length>=2?(S(i),window.location.href="/tier2/send.html"):(document.getElementById("question-block")&&(document.getElementById("question-block").style.display="none"),document.getElementById("completion-message")&&(document.getElementById("completion-message").style.display="block"))})}if(s>=m.length)v();else{E(s);const t=document.getElementById("submit-btn");t&&(t.onclick=()=>{const a=document.getElementById("answer");if(!a)return;const B=a.value.trim();B&&(l[s]=B,T(),s++,s<m.length?E(s):(document.getElementById("question-block")&&(document.getElementById("question-block").style.display="none"),document.getElementById("completion-message")&&(document.getElementById("completion-message").style.display="block"),v()))})}k(I,t=>{const a=t.val();a&&Object.keys(a).length>=2&&(S(I),window.location.href="/tier2/reveal.html")})}
