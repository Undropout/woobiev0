const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/preload-helper-DX5QSOJm.js","assets/firebase-config-DqIMhm9h.js"])))=>i.map(i=>d[i]);
import{o as _,g as v,r as l,d as c,b as E,c as L,a as D,e as V,u as x,s as z}from"./firebase-config-DqIMhm9h.js";/* empty css              */import{_ as K}from"./preload-helper-DX5QSOJm.js";import"./logout-C5vuDOMp.js";function J(a){return a.replace(new RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),o=>`<span class="woobie-emoji">${o}</span>`)}const C=["What makes you feel close to someone?","What does emotional intimacy look like to you?","What's a friendship you're proud of?","Who in your life do you wish you talked to more?","How do you want to be remembered?","What do you hope people say about you when you're not around?","What does 'home' mean to you?","When do you feel most loved?","What's a romantic gesture you secretly love?","What's your love language, and how do you express it?","How do you know when you're falling for someone?","Have you ever had a crush that changed how you see people?","What's something you've learned from past relationships?","Do you believe in soulmates?","What does a healthy relationship look like to you?","What's a photo you wish you had taken?","Do you have any little rituals that bring you peace?","If you could guarantee one thing for your future, what would it be?","What's a compliment you've always wanted to receive?","What's something you already find yourself appreciating about me?","Finish this sentence: 'I wish I had someone with whom I could share...'","Share an embarrassing or awkward moment in your life that you'd feel comfortable sharing with a friend.","When did you last cryâ€”alone or with someone elseâ€”and how do you feel about sharing it?","If your home were on fire, and your loved ones and pets were safe, what's one thing you'd try to save, and why?","Is there anything you consider too serious to joke about?","If you couldn't communicate with anyone ever again, what's one thing you'd deeply regret never having said?","Based on our conversation so far, what's something you like or appreciate about me? (Be honest!)","Complete this sentence three times: 'We both seem to be...'","If we became close friends, what's something important you'd want me to understand about you?","What's one thing you'd genuinely enjoy doing together if we were friends?","What's a quality you admire about how we've interacted with each other so far?","Share a personal problem you feel comfortable asking me advice aboutâ€”and tell me how you'd like me to respond (advice, reflection, support?).","What's a belief you held strongly that changed over time?","What's one thing you never get tired of talking about?","When have you felt the most brave?","How do you handle emotional pain?","What do you wish someone had told you earlier in life?","What kind of people do you feel safest around?","What's something you're currently working through internally?","When do you feel most vulnerable, and why?","What's a memory that always brings you comfort?","If your younger self met you now, what would they say?","What's a truth you've learned the hard way?","What's something you've forgiven yourself for?"];let h=[];_(D,async a=>{if(!a){alert("You must be logged in to participate. Redirecting to login."),window.location.href="/auth/login.html";return}const o=a.uid;let n=localStorage.getItem("woobieMatchID"),u=localStorage.getItem("woobieUsername");function w(e){const t=[...e];for(let s=t.length-1;s>0;s--){const y=Math.floor(Math.random()*(s+1));[t[s],t[y]]=[t[y],t[s]]}return t}if(!n||!u){const{update:e}=await K(async()=>{const{update:y}=await import("./preload-helper-DX5QSOJm.js").then(m=>m.i);return{update:y}},__vite__mapDeps([0,1])),s=(await v(l(c,`users/${o}/currentMatch`))).val();if(!s||!s.matchID||!s.username){alert("No match found. Please restart."),window.location.href="/name-picker/index.html";return}n=s.matchID,u=s.username,localStorage.setItem("woobieMatchID",n),localStorage.setItem("woobieUsername",u)}const i=l(c,`matches/${n}/tier3Questions`),f=l(c,`matches/${n}/users`);try{const e=await v(i);if(e.exists())h=e.val(),console.log("Loaded randomized questions for tier3 from match:",n);else{const t=await v(f),s=Object.keys(t.val()||{});if(s.length>0&&s.sort()[0]===o)h=w(C).slice(0,12),await E(i,h),console.log("Generated new randomized questions for tier3:",n);else{console.log("Waiting for partner to generate tier3 questions...");let m=0;for(;m<10;){await new Promise(M=>setTimeout(M,500));const b=await v(i);if(b.exists()){h=b.val(),console.log("Loaded tier3 questions after waiting");break}m++}h.length===0&&(console.warn("Timeout waiting for questions, using fallback"),h=C.slice(0,12))}}}catch(e){console.error("Error loading tier3 questions:",e),h=C.slice(0,12)}const r=l(c,`matches/${n}/tier3/${o}`),W=l(c,`matches/${n}/tier3`),S=l(c,`matches/${n}/tier3Votes/${o}`),P=l(c,`matches/${n}/tier3Votes`),T=l(c,`matches/${n}/tier3Drafts/${o}`),B=document.getElementById("question-block"),I=document.getElementById("completion-message"),q=document.getElementById("review-section"),F=document.getElementById("vote-section"),H=document.getElementById("vote-yes"),A=document.getElementById("vote-no"),U=document.getElementById("vote-waiting");function $(){H.style.display="none",A.style.display="none",U.style.display="block",L(P,e=>{const t=e.val();if(!t||Object.keys(t).length<2)return;const s=Object.values(t).every(b=>b===!0);V(P);const y=l(c,`users/${o}/currentMatch`),m=l(c,`users/${o}`);s?Promise.all([x(y,{stage:"chatroom"}),x(m,{stage:"chatroom"})]).then(()=>{window.location.href="/chat/index.html"}):Promise.all([x(y,{stage:"goodbye-tier3"}),x(m,{stage:"goodbye-tier3"})]).then(()=>{window.location.href="/goodbye.html"})})}H.onclick=()=>{E(S,!0).then($)},A.onclick=()=>{const e=prompt("If you're sure you want to end the match, type 'Goodbye' and press OK.");(e==null?void 0:e.trim().toLowerCase())==="goodbye"&&E(S,!1).then($)};let p=[],g=0;if((await v(r)).exists()){console.log("[Tier3] User has already submitted answers, checking for partner"),B.style.display="none",I.style.display="block";const t=(await v(W)).val();t&&Object.keys(t).length>=2?(I.style.display="none",G(t),(await v(S)).exists()&&(console.log("[Tier3] User has already voted, showing waiting message"),$())):Q();return}const R=await v(T);if(R.exists()){const e=R.val();p=e.answers||[],g=e.currentIndex||0,console.log("[Tier3] Loaded partial draft from database:",{answerCount:p.length,currentIndex:g})}else console.log("[Tier3] No draft found in database, starting fresh");let d=document.getElementById("waiting-message");d||(d=document.createElement("div"),d.id="waiting-message",d.innerHTML="<p>Waiting for your match to finish answering...</p>",d.style.color="#33ff33",d.style.textAlign="center",d.style.marginTop="2rem",d.style.display="none",B.parentNode.appendChild(d));function N(){const e={answers:p,currentIndex:g,lastSaved:Date.now()};E(T,e).then(()=>{console.log("[Tier3] Saved draft to database:",{answerCount:p.length,currentIndex:g})}).catch(t=>{console.error("[Tier3] Error saving draft to database:",t)})}function O(){if(g>=h.length){B.style.display="none",I.style.display="block",Y();return}document.getElementById("question-number").textContent=`Question ${g+1} of ${h.length}`,document.getElementById("question-text").textContent=h[g],document.getElementById("answer").value=p[g]||""}document.getElementById("submit-btn").onclick=()=>{const e=document.getElementById("answer").value.trim();e&&(p[g]=e,N(),g++,O())};async function Y(){await E(r,{answers:p,timestamp:Date.now(),woobieName:u}),await E(T,null),console.log("Tier3 draft cleared from database"),L(W,e=>{const t=e.val();t&&Object.keys(t).length>=2?(I.style.display="none",d.style.display="none",j(t)):(B.style.display="none",I.style.display="none",d.style.display="block")})}function G(e){j(e)}function Q(){B.style.display="none",I.style.display="block",L(W,e=>{const t=e.val();t&&Object.keys(t).length>=2&&(I.style.display="none",V(W),j(t))})}function j(e){var m;const t=Object.keys(e).find(b=>b!==o);if(!t)return;const s=p.length>0?p:((m=e[o])==null?void 0:m.answers)||[];let y="<h3>ðŸ“˜ Tier 3 Answers</h3>";h.forEach((b,M)=>{y+=`
        <details><summary><strong>${b}</strong></summary>
        <p><strong>You:</strong> ${s[M]||""}</p>
        <p><strong>Your Match:</strong> ${e[t].answers[M]||""}</p>
        </details>`}),q.innerHTML=J(y),q.style.display="block",F.style.display="block"}O()});function k(a){return a.replace(new RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),o=>`<span class="woobie-emoji">${o}</span>`)}function X(){navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&document.querySelectorAll(".woobie-emoji").forEach(o=>{o.style.setProperty("font-family","OpenMoji, monospace","important"),o.style.setProperty("color","#ffb000","important"),o.style.setProperty("text-shadow","0 0 10px #ffb000, 0 0 15px #ff9900","important"),o.style.setProperty("display","inline-block","important"),o.style.setProperty("font-weight","normal","important"),o.style.setProperty("font-style","normal","important")})}document.addEventListener("DOMContentLoaded",()=>{const a=document.querySelector("h1");a&&(a.innerHTML=k(a.textContent));const o=document.getElementById("logout-button");o&&(o.innerHTML=k(o.textContent));const n=document.getElementById("vote-yes"),u=document.getElementById("vote-no");n&&(n.innerHTML=k(n.textContent)),u&&(u.innerHTML=k(u.textContent));const w=document.getElementById("close-story");w&&(w.innerHTML=k(w.textContent));const i=document.querySelector("#our-story-modal h2");i&&(i.innerHTML=k(i.textContent));const f=document.getElementById("our-story-button");f&&(f.innerHTML=k(f.textContent));const r=document.getElementById("submit-btn");r&&r.textContent==="Next"&&(r.innerHTML='Next <span class="woobie-emoji">â†’</span>'),setTimeout(X,100)});const Z=document.getElementById("logout-button");Z.onclick=async()=>{if(confirm("Are you sure you want to log out? You'll lose your place unless you're logged in.")){try{await z(D)}catch(o){console.warn("Firebase sign-out failed:",o)}localStorage.clear(),sessionStorage.clear(),window.location.href="/resume.html"}};_(D,async a=>{if(!a){alert("You must be logged in to participate. Redirecting to login."),window.location.href="/auth/login.html";return}const o=a.uid,n=localStorage.getItem("woobieMatchID");if(!n){alert("Missing Match ID. Please restart."),window.location.href="/name-picker/index.html";return}await x(l(c,`users/${o}/currentMatch`),{stage:"tier3"}),document.getElementById("vote-yes"),document.getElementById("vote-no"),document.getElementById("vote-waiting"),l(c,`matches/${n}/tier3Votes/${o}`),l(c,`matches/${n}/tier3Votes`);const u=document.getElementById("our-story-button"),w=document.getElementById("close-story"),i=document.getElementById("story-content"),f=document.getElementById("our-story-modal");u&&f&&i&&w&&(u.onclick=async()=>{f.style.display="block",i.innerHTML="<p>Loading...</p>";try{const r=document.createElement("iframe");r.src="/shared/history.html",r.style.width="100%",r.style.height="70vh",r.style.border="1px solid #33ff33",r.style.backgroundColor="black",i.innerHTML="",i.appendChild(r)}catch(r){console.error(r),i.innerHTML='<p style="color:red;">Error loading story.</p>'}},w.onclick=()=>{f.style.display="none"})});
