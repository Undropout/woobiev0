import{s as K,a as x,o as X,u as Z,r as m,d as y,g as B,b as N,c as F,e as O}from"./firebase-config-C0024qU1.js";/* empty css              */import"./logout-q5yztgx1.js";function c(e){return e.replace(new RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),t=>`<span class="woobie-emoji">${t}</span>`)}document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("h1");e.innerHTML=c(e.textContent);const t=document.getElementById("logout-button");t.innerHTML=c(t.textContent);const n=document.getElementById("vote-yes"),r=document.getElementById("vote-no");n.innerHTML=c(n.textContent),r.innerHTML=c(r.textContent);const a=document.getElementById("close-story");a.innerHTML=c(a.textContent);const s=document.querySelector("#our-story-modal h2");s.innerHTML=c(s.textContent);const i=document.getElementById("our-story-button");i.innerHTML=c(i.textContent)});const ee=document.getElementById("logout-button");ee.onclick=async()=>{if(confirm("Are you sure you want to log out? You'll lose your place unless you're logged in.")){try{await K(x)}catch(t){console.warn("Firebase sign-out failed:",t)}localStorage.clear(),sessionStorage.clear(),window.location.href="/index.html"}};const u=localStorage.getItem("woobieMatchID"),H=document.getElementById("reward-box"),V=document.getElementById("vote-yes"),P=document.getElementById("vote-no"),te=document.getElementById("vote-section"),oe=document.getElementById("vote-waiting");let d=null;function C(e){let t="";e.text&&(t+=`<h3>üìù Message</h3><p style="white-space:pre-line;">${e.text}</p>`),e.imageURL&&(t+=`<h3>üñºÔ∏è Image</h3><img src="${e.imageURL}" alt="${e.alt||"Image from your match"}" style="max-width:100%; border:1px solid #33ff33;" />`),e.audioURL&&(t+=`<h3>üîä Voice Message</h3><audio controls src="${e.audioURL}"></audio>`);const n=c(t);H.innerHTML=n||"<p>Your match sent an empty reward.</p>",te.style.display="block"}async function ne(){if(d)try{const e=m(y,`matches/${u}/tier2Rewards`),n=(await B(e)).val(),r=n?Object.keys(n).find(s=>s!==d):null,a=r?n[r]:null;if(r&&a)C(a);else{H.innerHTML="<p>Your match has not submitted a reward yet. Waiting...</p>";const s=N(e,i=>{const l=i.val(),p=l?Object.keys(l).find(M=>M!==d):null,b=p?l[p]:null;p&&b&&(C(b),F(e,s))})}}catch(e){H.innerHTML='<p style="color:#ff6666;">Failed to load reward.</p>',console.error("Error loading reward:",e)}}let R=!1;function Q(){if(V.style.display="none",P.style.display="none",oe.style.display="block",!R){R=!0;const e=m(y,`matches/${u}/tier2Votes`),t=N(e,n=>{const r=n.val();if(!r||Object.keys(r).length<2)return;const a=Object.values(r).every(s=>s===!0);F(e,t),window.location.href=a?"/tier3/index.html":"/goodbye.html"})}}V.onclick=async()=>{if(d)try{const e=m(y,`matches/${u}/tier2Votes/${d}`);await O(e,!0),Q()}catch(e){console.error("Error voting:",e),alert("Failed to submit vote. Please try again.")}};P.onclick=async()=>{const e=prompt("If you're sure you want to end the match, type 'Goodbye' to confirm.");if((e==null?void 0:e.trim().toLowerCase())==="goodbye"){if(!d)return;try{const t=m(y,`matches/${u}/tier2Votes/${d}`);await O(t,!1),Q()}catch(t){console.error("Error voting:",t),alert("Failed to submit vote. Please try again.")}}};X(x,async e=>{e?(d=e.uid,localStorage.getItem("woobieUsername"),await Z(m(y,`users/${e.uid}/currentMatch`),{stage:"tier2-reveal"}),ne()):window.location.href="/auth/login.html"});const D=document.getElementById("our-story-button"),j=document.getElementById("close-story"),f=document.getElementById("story-content"),k=document.getElementById("our-story-modal");D&&k&&f&&j&&(D.onclick=async()=>{var e,t,n,r,a,s;k.style.display="block",f.innerHTML="<p>Loading...</p>";try{const i=x.currentUser;if(!i||!u){f.innerHTML="<p>Error loading story.</p>";return}const l=i.uid,[p,b,M]=await Promise.all([B(m(y,`matches/${u}/tier1a`)),B(m(y,`matches/${u}/tier1b`)),B(m(y,`matches/${u}/tier2`))]),A=p.val()||{},S=b.val()||{},T=M.val()||{},L=Object.keys(T).find(h=>h!==l);if(!L){f.innerHTML="<p>Waiting for your match to complete their answers...</p>";return}const q=["What's something you're proud of recently?","How would a friend describe you?","What does comfort look like to you?","When do you feel most alive?","What's a recent thought you can't shake?","How do you usually show someone you care?"],G=["What's something you're working on improving?","How do you recharge after a stressful day?","What's a non-negotiable value in your life?","What do you want more of in your future?","What makes you feel heard?","What's a memory you'd share to explain who you are?"],_=["What's a moment in your life that changed the way you see the world?","How do you show someone you care about them?","What's something people often misunderstand about you?","When do you feel most like yourself?","What's one thing you wish more people asked you about?","What makes you feel seen or understood?","What's a belief you held strongly that changed over time?","What's one thing you never get tired of talking about?","When have you felt the most brave?","What do you wish someone had told you earlier in life?","What kind of people do you feel safest around?","What's something you've forgiven yourself for?"];let g="<h3>üìò Tier 1a Answers</h3>";const E=((e=A[l])==null?void 0:e.answers)||[],I=((t=A[L])==null?void 0:t.answers)||[];q.forEach((h,o)=>{var w,v;const W=Array.isArray(E)&&((w=E[o])==null?void 0:w.value)||E[o],$=Array.isArray(I)&&((v=I[o])==null?void 0:v.value)||I[o];g+=`
              <details><summary><strong>${h}</strong></summary>
              <p><strong>You:</strong> ${W||"<em>No answer</em>"}</p>
              <p><strong>Your Match:</strong> ${$||"<em>No answer</em>"}</p>
              </details>`}),g+="<h3>üìò Tier 1b Answers</h3>";const U=((n=S[l])==null?void 0:n.answers)||[],Y=((r=S[L])==null?void 0:r.answers)||[];G.forEach((h,o)=>{var w,v;const W=((w=U[o])==null?void 0:w.value)||U[o]||"<em>No answer</em>",$=((v=Y[o])==null?void 0:v.value)||Y[o]||"<em>No answer</em>";g+=`
              <details><summary><strong>${h}</strong></summary>
              <p><strong>You:</strong> ${W}</p>
              <p><strong>Your Match:</strong> ${$}</p>
              </details>`}),g+="<h3>üìò Tier 2 Answers</h3>";const z=((a=T[l])==null?void 0:a.answers)||[],J=((s=T[L])==null?void 0:s.answers)||[];_.forEach((h,o)=>{g+=`
              <details><summary><strong>${h}</strong></summary>
              <p><strong>You:</strong> ${z[o]||"<em>No answer</em>"}</p>
              <p><strong>Your Match:</strong> ${J[o]||"<em>No answer</em>"}</p>
              </details>`}),f.innerHTML=c(g)}catch(i){f.innerHTML='<p style="color:red;">Error loading story.</p>',console.error(i)}},j.onclick=()=>{k.style.display="none"});
