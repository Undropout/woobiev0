import{o as v,r as l,d as c,u as g,g as C,a as A,e as $,i as U}from"./firebase-config-C0024qU1.js";/* empty css              */import"./logout-q5yztgx1.js";const q=["Books","Gaming","Music","Art","Nature","Cooking","Fitness","Travel","Animals","Science","Tech","Movies"],B=["Racism","Homophobia","Conspiracies","Aggression","Unreliability","Boundary issues"];let u=new Set,m=new Set;const y=document.getElementById("interest-options"),w=document.getElementById("dealbreaker-options"),E=document.getElementById("gender-identity"),I=document.getElementById("looking-for-gender-options"),p=document.getElementById("continue-btn"),i=document.getElementById("message");let r=null,h=null,b=null,x=null;y.innerHTML="";w.innerHTML="";function D(t,e,o){const n=t.textContent;e.has(n)?(e.delete(n),t.classList.remove("selected")):e.size<o?(e.add(n),t.classList.add("selected")):(i.textContent=`You can select a maximum of ${o} items for this section.`,setTimeout(()=>i.textContent="",3e3))}q.forEach(t=>{const e=document.createElement("button");e.textContent=t,e.className="woobie-button",e.onclick=()=>D(e,u,6),y.appendChild(e)});B.forEach(t=>{const e=document.createElement("button");e.textContent=t,e.className="woobie-button",e.onclick=()=>D(e,m,3),w.appendChild(e)});const d=document.getElementById("lf_any"),k=I.querySelectorAll('input[type="checkbox"]:not(#lf_any)');d&&d.addEventListener("change",t=>{t.target.checked?k.forEach(e=>{e.checked=!1,e.disabled=!0}):k.forEach(e=>e.disabled=!1)});v(A,async t=>{if(t){if(r=t.uid,h=localStorage.getItem("woobieUsername"),b=localStorage.getItem("woobieMode"),x=localStorage.getItem("woobieEmoji"),!h||!b||!r){i.textContent="Critical session data missing (name, mode, or UID). Please start over from name picking.",setTimeout(()=>window.location.href="/name-picker/index.html",3e3),p.disabled=!0;return}try{const e=l(c,`users/${r}/currentMatch`);await g(e,{stage:"interests-dealbreakers"})}catch(e){console.error("Error updating user stage to interests-dealbreakers:",e)}try{const e=await C(l(c,`users/${r}/profileDetails`));if(e.exists()){const o=e.val();o.gender&&(E.value=o.gender),o.lookingForGender&&I.querySelectorAll('input[type="checkbox"]').forEach(s=>{o.lookingForGender.includes(s.value)&&(s.checked=!0,s.value==="any"&&k.forEach(a=>a.disabled=!0))}),o.interests&&(u=new Set(o.interests),y.querySelectorAll(".woobie-button").forEach(n=>{u.has(n.textContent)&&n.classList.add("selected")})),o.dealbreakers&&(m=new Set(o.dealbreakers),w.querySelectorAll(".woobie-button").forEach(n=>{m.has(n.textContent)&&n.classList.add("selected")}))}}catch(e){console.error("Error pre-filling preferences:",e),i.textContent="Could not load saved preferences. Please select them again."}}else i.textContent="You must be logged in. Redirecting to login...",setTimeout(()=>window.location.href="/auth/login.html",2e3),p.disabled=!0});p.onclick=async()=>{if(!r){i.textContent="Authentication error. Please log in again.";return}if(u.size<3){i.textContent="Please pick at least 3 interests.";return}const t=E.value;let e=[];if(d&&d.checked?e.push("any"):I.querySelectorAll('input[type="checkbox"]:checked').forEach(s=>{e.push(s.value)}),!d.checked&&e.length===0){i.textContent='Please select what gender of friend you are looking for, or choose "Any".';return}const o=[...u],n=[...m];try{const s=l(c,`users/${r}/profileDetails`);await g(s,{gender:t,lookingForGender:e,interests:o,dealbreakers:n}),console.log("User profile details saved for UID:",r);let a=localStorage.getItem("woobieMatchID");a||(a=`m-${Date.now()}-${Math.floor(Math.random()*1e3)}`,localStorage.setItem("woobieMatchID",a));const f=await C(l(c,`users/${r}/currentMatch`));f.exists()&&f.val().matchID?a=f.val().matchID:await g(l(c,`users/${r}/currentMatch`),{matchID:a}),localStorage.setItem("woobieMatchID",a);const M=l(c,`queue/${r}`);await $(M,{userUID:r,woobieName:h,mode:b,emoji:x,gender:t,lookingForGender:e,interests:o,dealbreakers:n,potentialMatchIDForUser:a,timestamp:U()});const S=l(c,`users/${r}/currentMatch`);await g(S,{stage:"waiting_in_queue",matchID:a,username:h}),console.log(`User ${r} added to queue with potentialMatchID: ${a}`),window.location.href="/interests-dealbreakers/waiting.html"}catch(s){console.error("Error saving preferences and adding to queue:",s),i.textContent="Error saving your preferences. Please try again."}};
