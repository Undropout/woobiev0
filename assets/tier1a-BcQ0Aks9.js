import{s as H,a as q,o as N,r as c,d as h,u as k,g as I,b as x,c as W,e as B}from"./firebase-config-CQBF9bbN.js";/* empty css              */import"./feedback-CLnNHjql.js";function V(t){return t.replace(new RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),o=>`<span class="woobie-emoji">${o}</span>`)}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("logout-button");t.innerHTML=V(t.textContent);const o=document.getElementById("submit-btn");o.innerHTML='Next <span class="woobie-emoji">‚Üí</span>'});const G=document.getElementById("logout-button");G.onclick=async()=>{if(confirm("Are you sure you want to log out? You'll lose your place unless you're logged in.")){try{await H(q)}catch(o){console.warn("Firebase sign-out failed:",o)}localStorage.clear(),sessionStorage.clear(),window.location.href="/index.html"}};window.addEventListener("tier1aComplete",()=>{N(q,async t=>{if(!t)return;const o=c(h,`users/${t.uid}/currentMatch`);await k(o,{stage:"tier1a-complete"})})});const z=localStorage.getItem("woobieUsername"),P=localStorage.getItem("woobieMatchID");(!z||!P)&&(alert("Missing username or match ID"),window.location.href="/auth/login.html");const S=["If you could invite anyone in history to dinner, who would you choose and why?","Would you ever want to be famous? If yes, what would you want to be known for?","Do you rehearse conversations before you have them? Why or why not?","Describe your 'perfect' day.","When did you last sing to yourself or to someone else?","If you could have one extraordinary skill or quality tomorrow, what would it be and why?","What's a secret hunch you have about your future?","What are you deeply grateful for right now?","If you could change something about your upbringing, what would it be?","Share a memory from your childhood that shaped who you are today.","What's something important about you that people often misunderstand, that you'd like a future friend to know?","If you could live to age 90, would you rather retain the mind or body of a 30-year-old for your final 60 years?","If you could live in any fictional world, which would you choose and why?","If you could instantly master a musical instrument, which would it be?","If animals could talk, which one do you think you'd get along with best?","What era in history do you feel oddly nostalgic for?","What makes you feel seen?","What's the most generous thing someone has done for you?","How do you show someone you care?","What's your go-to movie or show when you need a pick-me-up?","Do you prefer sunrise or sunset?","What do you do when you want to feel cozy?","Do you believe people are inherently good?","If happiness were a place, what would it look like?","What do you think is humanity's greatest strength?","What's your dream vacation destination, and what would you do there?","What's your most chaotic or impulsive story?","What's a strength of yours that others overlook?","Do you forgive yourself easily?","What kind of environments help you thrive?","What helps you bounce back after a hard day?"];let u=[],v=[],f=0;const D=document.getElementById("question-block"),j=document.getElementById("question-number"),L=document.getElementById("question-text"),$=document.getElementById("answer"),R=document.getElementById("submit-btn"),w=document.getElementById("completion-message"),M=document.getElementById("review");function C(t,o){var b,p;const i=Object.keys(t).find(a=>a!==o);if(!i){console.log("Waiting for partner's answers..."),w.style.display="block";return}w.style.display="none";const r=t[o],l=t[i];if(!r||!l){console.error("Own or partner's answers missing, though both UIDs are present.");return}const y=Array.isArray(r)?r:r.answers||[],E=Array.isArray(l)?l:l.answers||[];M.style.display="block",M.innerHTML="<h2>Your Answers vs Your Match's</h2>";for(let a=0;a<u.length;a++)M.innerHTML+=`
      <details>
        <summary><strong>${u[a]}</strong></summary>
        <p><strong>You:</strong> ${((b=y[a])==null?void 0:b.value)||y[a]||"<em>No answer</em>"}</p>
        <p><strong>Match:</strong> ${((p=E[a])==null?void 0:p.value)||E[a]||"<em>No answer</em>"}</p>
      </details>
    `;M.innerHTML+=`
    <div style="margin-top: 2rem; text-align: center;">
      <button id="vote-yes" class="woobie-button">üëç Continue</button>
      <button id="vote-no" class="woobie-button">üëé No thanks</button>
      <p id="vote-waiting" style="display:none; color:#33ff33;">Waiting for your match's vote...</p>
    </div>
  `,document.getElementById("vote-yes").onclick=()=>O(!0,o),document.getElementById("vote-no").onclick=()=>{const a=prompt("If you're sure you want to end the match, type 'Goodbye' to confirm.");(a==null?void 0:a.trim().toLowerCase())==="goodbye"&&O(!1,o)}}function O(t,o){const i=c(h,`matches/${P}/tier1aVotes/${o}`);x(i,t),document.getElementById("vote-yes").style.display="none",document.getElementById("vote-no").style.display="none",document.getElementById("vote-waiting").style.display="block"}N(q,t=>{if(!t){alert("You must be logged in to participate. Redirecting to login."),window.location.href="/auth/login.html";return}const o=t.uid;let i=localStorage.getItem("woobieMatchID"),r=localStorage.getItem("woobieUsername");if(!i||!r){I(c(h,`users/${o}/currentMatch`)).then(l=>{const y=l.val();if(!y||!y.matchID||!y.username){alert("No match found. Please restart."),window.location.href="/name-picker/index.html";return}i=y.matchID,r=y.username,localStorage.setItem("woobieMatchID",i),localStorage.setItem("woobieUsername",r),Q(o,i,r)}).catch(l=>{console.error("Error fetching match data:",l),alert("Error loading session. Please try again.")});return}Q(o,i,r)});async function Q(t,o,i){function r(n){const e=[...n];for(let s=e.length-1;s>0;s--){const m=Math.floor(Math.random()*(s+1));[e[s],e[m]]=[e[m],e[s]]}return e}const l=c(h,`matches/${o}/tier1Questions`),y=c(h,`matches/${o}/users`);try{const n=await I(l);if(n.exists())u=n.val().slice(0,6);else{const e=await I(y),s=Object.keys(e.val()||{});if(s.length>0&&s.sort()[0]===t){const d=r(S).slice(0,12);await x(l,d),u=d.slice(0,6),console.log("Generated new randomized questions for match:",o)}else{console.log("Waiting for partner to generate tier1 questions...");let g=0;for(;g<10;){await new Promise(T=>setTimeout(T,500));const d=await I(l);if(d.exists()){u=d.val().slice(0,6),console.log("Loaded tier1 questions after waiting");break}g++}u.length===0&&(console.warn("Timeout waiting for questions, using fallback"),u=r(S).slice(0,6))}}}catch(n){console.error("Error loading questions:",n),u=r(S).slice(0,6)}const E=c(h,`matches/${o}/tier1a/${t}`),b=c(h,`matches/${o}/tier1a`),p=c(h,`matches/${o}/tier1aVotes`),a=c(h,`matches/${o}/tier1aDrafts/${t}`);try{if((await I(E)).exists()){D.style.display="none",w.style.display="block",W(b,e=>{const s=e.val();s&&Object.keys(s).length>=2&&s[t]&&C(s,t)}),W(p,e=>{const s=e.val();if(!s)return;const m=Object.values(s);if(m.length<2)return;const g=m.every(T=>T===!0);B(p),B(b);const d=c(h,`users/${t}/currentMatch`);g?k(d,{stage:"tier1a-bios-revealed"}).then(()=>{window.location.href="/tier1a/reveal-bios.html"}):k(d,{stage:"tier1a-vote-no"}).then(()=>{window.location.href="/goodbye.html"})});return}}catch(n){console.error("Error checking existing answers:",n)}try{const n=await I(a);if(n.exists()){const e=n.val();v=e.answers||[],f=e.currentIndex||0,console.log("[Tier1a] Loaded partial draft from database:",{answerCount:v.length,currentIndex:f})}else console.log("[Tier1a] No draft found in database, starting fresh")}catch(n){console.error("Error loading tier1a draft from database:",n)}function Y(){const n={answers:v,currentIndex:f,lastSaved:Date.now()};x(a,n).then(()=>{console.log("[Tier1a] Saved draft to database:",{answerCount:v.length,currentIndex:f})}).catch(e=>{console.error("[Tier1a] Error saving draft to database:",e)})}function A(){var n;if(f>=u.length){D.style.display="none",w.style.display="block",x(E,{answers:v,woobieName:i,timestamp:Date.now()}).then(()=>(console.log("Tier1a answers saved successfully"),x(a,null))).then(()=>{console.log("Tier1a draft cleared from database");const e=c(h,`users/${t}/currentMatch`);return k(e,{stage:"tier1a-answers-submitted"})}).catch(e=>console.error("Error saving tier1a answers:",e));return}j&&(j.textContent=`Question ${f+1} of ${u.length}`),L&&(L.textContent=u[f]),$&&($.value=((n=v[f])==null?void 0:n.value)||"")}R&&(R.onclick=()=>{if(!$)return;const n=$.value.trim();n&&(v[f]={question:u[f],value:n,format:"text"},f++,Y(),A())}),W(b,n=>{const e=n.val();e&&Object.keys(e).length>=2?e[t]?C(e,t):w&&(w.style.display="block"):e&&Object.keys(e).length===1&&e[t]&&w&&(w.style.display="block")}),W(p,n=>{const e=n.val();if(!e)return;const s=Object.values(e);if(s.length<2)return;const m=s.every(d=>d===!0);B(p),B(b);const g=c(h,`users/${t}/currentMatch`);m?k(g,{stage:"tier1a-bios-revealed"}).then(()=>{window.location.href="/tier1a/reveal-bios.html"}):k(g,{stage:"tier1a-vote-no"}).then(()=>{window.location.href="/goodbye.html"})}),A()}
