import{s as C,a as I,o as R,u as S,r as l,d as i,g as E,c as M,e as x,b as T}from"./firebase-config-DqIMhm9h.js";/* empty css              */import"./logout-C5vuDOMp.js";function s(t){return t.replace(new RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),e=>`<span class="woobie-emoji">${e}</span>`)}document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector("h1");t.innerHTML=s(t.textContent);const e=document.getElementById("logout-button");e.innerHTML=s(e.textContent);const o=document.getElementById("vote-yes"),n=document.getElementById("vote-no");o.innerHTML=s(o.textContent),n.innerHTML=s(n.textContent);const c=document.getElementById("close-story");c.innerHTML=s(c.textContent);const r=document.querySelector("#our-story-modal h2");r.innerHTML=s(r.textContent);const m=document.getElementById("our-story-button");m.innerHTML=s(m.textContent)});const V=document.getElementById("logout-button");V.onclick=async()=>{if(confirm("Are you sure you want to log out? You'll lose your place unless you're logged in.")){try{await C(I)}catch(e){console.warn("Firebase sign-out failed:",e)}localStorage.clear(),sessionStorage.clear(),window.location.href="/index.html"}};const u=localStorage.getItem("woobieMatchID"),f=document.getElementById("reward-box"),H=document.getElementById("vote-yes"),$=document.getElementById("vote-no"),U=document.getElementById("vote-section"),j=document.getElementById("vote-waiting");let a=null;function v(t){let e="";t.text&&(e+=`<h3>üìù Message</h3><p style="white-space:pre-line;">${t.text}</p>`),t.imageURL&&(e+=`<h3>üñºÔ∏è Image</h3><img src="${t.imageURL}" alt="${t.alt||"Image from your match"}" style="max-width:100%; border:1px solid #33ff33;" />`),t.audioURL&&(e+=`<h3>üîä Voice Message</h3><audio controls src="${t.audioURL}"></audio>`);const o=s(e);f.innerHTML=o||"<p>Your match sent an empty reward.</p>",U.style.display="block"}async function F(){if(a)try{const t=l(i,`matches/${u}/tier2Rewards`),o=(await E(t)).val(),n=o?Object.keys(o).find(r=>r!==a):null,c=n?o[n]:null;if(n&&c)v(c);else{f.innerHTML="<p>Your match has not submitted a reward yet. Waiting...</p>";const r=M(t,m=>{const y=m.val(),g=y?Object.keys(y).find(k=>k!==a):null,w=g?y[g]:null;g&&w&&(v(w),x(t,r))})}}catch(t){f.innerHTML='<p style="color:#ff6666;">Failed to load reward.</p>',console.error("Error loading reward:",t)}}let b=!1;function p(){if(H.style.display="none",$.style.display="none",j.style.display="block",!b){b=!0;const t=l(i,`matches/${u}/tier2Votes`),e=M(t,o=>{const n=o.val();if(!n||Object.keys(n).length<2)return;const c=Object.values(n).every(r=>r===!0);x(t,e),window.location.href=c?"/tier3/index.html":"/goodbye.html"})}}H.onclick=async()=>{if(a)try{const t=l(i,`matches/${u}/tier2Votes/${a}`);await T(t,!0),p()}catch(t){console.error("Error voting:",t),alert("Failed to submit vote. Please try again.")}};$.onclick=async()=>{const t=prompt("If you're sure you want to end the match, type 'Goodbye' to confirm.");if((t==null?void 0:t.trim().toLowerCase())==="goodbye"){if(!a)return;try{const e=l(i,`matches/${u}/tier2Votes/${a}`);await T(e,!1),p()}catch(e){console.error("Error voting:",e),alert("Failed to submit vote. Please try again.")}}};R(I,async t=>{if(t){a=t.uid,localStorage.getItem("woobieUsername"),await S(l(i,`users/${t.uid}/currentMatch`),{stage:"tier2-reveal"});const e=l(i,`matches/${u}/tier2Votes/${t.uid}`);(await E(e)).exists()&&(console.log("[Tier2 Reveal] User has already voted, waiting for partner..."),p()),F()}else window.location.href="/auth/login.html"});const B=document.getElementById("our-story-button"),L=document.getElementById("close-story"),d=document.getElementById("story-content"),h=document.getElementById("our-story-modal");B&&h&&d&&L&&(B.onclick=async()=>{h.style.display="block",d.innerHTML="<p>Loading...</p>";try{const t=document.createElement("iframe");t.src="/shared/history.html",t.style.width="100%",t.style.height="70vh",t.style.border="1px solid #33ff33",t.style.backgroundColor="black",d.innerHTML="",d.appendChild(t)}catch(t){console.error(t),d.innerHTML='<p style="color:red;">Error loading story.</p>'}},L.onclick=()=>{h.style.display="none"});
