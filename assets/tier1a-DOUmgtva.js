import{s as W,a as T,o as O,r as u,d as m,u as f,g as $,b as I,c as k,e as M}from"./firebase-config-C0024qU1.js";/* empty css              */function H(t){return t.replace(new RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),o=>`<span class="woobie-emoji">${o}</span>`)}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("logout-button");t.innerHTML=H(t.textContent);const o=document.getElementById("submit-btn");o.innerHTML='Next <span class="woobie-emoji">‚Üí</span>'});const P=document.getElementById("logout-button");P.onclick=async()=>{if(confirm("Are you sure you want to log out? You'll lose your place unless you're logged in.")){try{await W(T)}catch(o){console.warn("Firebase sign-out failed:",o)}localStorage.clear(),sessionStorage.clear(),window.location.href="/index.html"}};window.addEventListener("tier1aComplete",()=>{O(T,async t=>{if(!t)return;const o=u(m,`users/${t.uid}/currentMatch`);await f(o,{stage:"tier1a-complete"})})});const Y=localStorage.getItem("woobieUsername"),q=localStorage.getItem("woobieMatchID");(!Y||!q)&&(alert("Missing username or match ID"),window.location.href="/auth/login.html");const y=["What's something you're proud of recently?","How would a friend describe you?","What does comfort look like to you?","When do you feel most alive?","What's a recent thought you can't shake?","How do you usually show someone you care?"];let g=[],l=0;const A=document.getElementById("question-block"),S=document.getElementById("question-number"),L=document.getElementById("question-text"),x=document.getElementById("answer"),j=document.getElementById("submit-btn"),d=document.getElementById("completion-message"),B=document.getElementById("review");function D(t,o){var b,w;const i=Object.keys(t).find(e=>e!==o);if(!i){console.log("Waiting for partner's answers..."),d.style.display="block";return}d.style.display="none";const s=t[o],a=t[i];if(!s||!a){console.error("Own or partner's answers missing, though both UIDs are present.");return}const r=Array.isArray(s)?s:s.answers||[],h=Array.isArray(a)?a:a.answers||[];B.style.display="block",B.innerHTML="<h2>Your Answers vs Your Match's</h2>";for(let e=0;e<y.length;e++)B.innerHTML+=`
      <details>
        <summary><strong>${y[e]}</strong></summary>
        <p><strong>You:</strong> ${((b=r[e])==null?void 0:b.value)||r[e]||"<em>No answer</em>"}</p>
        <p><strong>Match:</strong> ${((w=h[e])==null?void 0:w.value)||h[e]||"<em>No answer</em>"}</p>
      </details>
    `;B.innerHTML+=`
    <div style="margin-top: 2rem; text-align: center;">
      <button id="vote-yes" class="woobie-button">üëç Continue</button>
      <button id="vote-no" class="woobie-button">üëé No thanks</button>
      <p id="vote-waiting" style="display:none; color:#33ff33;">Waiting for your match's vote...</p>
    </div>
  `,document.getElementById("vote-yes").onclick=()=>C(!0,o),document.getElementById("vote-no").onclick=()=>{const e=prompt("If you're sure you want to end the match, type 'Goodbye' to confirm.");(e==null?void 0:e.trim().toLowerCase())==="goodbye"&&C(!1,o)}}function C(t,o){const i=u(m,`matches/${q}/tier1aVotes/${o}`);M(i,t),document.getElementById("vote-yes").style.display="none",document.getElementById("vote-no").style.display="none",document.getElementById("vote-waiting").style.display="block"}O(T,t=>{if(!t){alert("You must be logged in to participate. Redirecting to login."),window.location.href="/auth/login.html";return}const o=t.uid;let i=localStorage.getItem("woobieMatchID"),s=localStorage.getItem("woobieUsername");if(!i||!s){$(u(m,`users/${o}/currentMatch`)).then(a=>{const r=a.val();if(!r||!r.matchID||!r.username){alert("No match found. Please restart."),window.location.href="/name-picker/index.html";return}i=r.matchID,s=r.username,localStorage.setItem("woobieMatchID",i),localStorage.setItem("woobieUsername",s),R(o,i,s)}).catch(a=>{console.error("Error fetching match data:",a),alert("Error loading session. Please try again.")});return}R(o,i,s)});async function R(t,o,i){const s=u(m,`matches/${o}/tier1a/${t}`),a=u(m,`matches/${o}/tier1a`),r=u(m,`matches/${o}/tier1aVotes`),h=u(m,`matches/${o}/tier1aDrafts/${t}`);try{if((await $(s)).exists()){A.style.display="none",d.style.display="block",I(a,n=>{const c=n.val();c&&Object.keys(c).length>=2&&c[t]&&D(c,t)}),I(r,n=>{const c=n.val();if(!c)return;const p=Object.values(c);if(p.length<2)return;const v=p.every(N=>N===!0);k(r),k(a);const E=u(m,`users/${t}/currentMatch`);v?f(E,{stage:"tier1a-bios-revealed"}).then(()=>{window.location.href="/tier1a/reveal-bios.html"}):f(E,{stage:"tier1a-vote-no"}).then(()=>{window.location.href="/goodbye.html"})});return}}catch(e){console.error("Error checking existing answers:",e)}try{const e=await $(h);if(e.exists()){const n=e.val();g=n.answers||[],l=n.currentIndex||0,console.log("[Tier1a] Loaded partial draft from database:",{answerCount:g.length,currentIndex:l})}else console.log("[Tier1a] No draft found in database, starting fresh")}catch(e){console.error("Error loading tier1a draft from database:",e)}function b(){const e={answers:g,currentIndex:l,lastSaved:Date.now()};M(h,e).then(()=>{console.log("[Tier1a] Saved draft to database:",{answerCount:g.length,currentIndex:l})}).catch(n=>{console.error("[Tier1a] Error saving draft to database:",n)})}function w(){var e;if(l>=y.length){A.style.display="none",d.style.display="block",M(s,{answers:g,woobieName:i,timestamp:Date.now()}).then(()=>(console.log("Tier1a answers saved successfully"),M(h,null))).then(()=>{console.log("Tier1a draft cleared from database");const n=u(m,`users/${t}/currentMatch`);return f(n,{stage:"tier1a-answers-submitted"})}).catch(n=>console.error("Error saving tier1a answers:",n));return}S&&(S.textContent=`Question ${l+1} of ${y.length}`),L&&(L.textContent=y[l]),x&&(x.value=((e=g[l])==null?void 0:e.value)||"")}j&&(j.onclick=()=>{if(!x)return;const e=x.value.trim();e&&(g[l]={question:y[l],value:e,format:"text"},l++,b(),w())}),I(a,e=>{const n=e.val();n&&Object.keys(n).length>=2?n[t]?D(n,t):d&&(d.style.display="block"):n&&Object.keys(n).length===1&&n[t]&&d&&(d.style.display="block")}),I(r,e=>{const n=e.val();if(!n)return;const c=Object.values(n);if(c.length<2)return;const p=c.every(E=>E===!0);k(r),k(a);const v=u(m,`users/${t}/currentMatch`);p?f(v,{stage:"tier1a-bios-revealed"}).then(()=>{window.location.href="/tier1a/reveal-bios.html"}):f(v,{stage:"tier1a-vote-no"}).then(()=>{window.location.href="/goodbye.html"})}),w()}
