import{s as P,a as w,o as k,g as f,r as l,u as y,d as c,b as h,c as M,e as R}from"./firebase-config-DqIMhm9h.js";/* empty css              */import"./logout-C5vuDOMp.js";function L(t){return t.replace(new RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),o=>`<span class="woobie-emoji">${o}</span>`)}document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector("h1");t.innerHTML=L(t.textContent);const o=document.getElementById("logout-button");o.innerHTML=L(o.textContent)});const F=document.getElementById("logout-button");F.onclick=async()=>{if(confirm("Are you sure you want to log out? You'll lose your place unless you're logged in.")){try{await P(w)}catch(o){console.warn("Firebase sign-out failed:",o)}localStorage.clear(),sessionStorage.clear(),window.location.href="/resume.html"}};localStorage.getItem("woobieUsername");localStorage.getItem("woobieMatchID");const E=t=>l(c,`users/${t}/currentMatch`);k(w,async t=>{if(t){const s=(await f(E(t.uid))).val();(!s||!s.stage||s.stage==="tier1a")&&await y(E(t.uid),{stage:"tier2"})}});window.addEventListener("tier2Complete",()=>{k(w,async t=>{if(!t)return;const o=E(t.uid);await y(o,{stage:"tier2-complete"})})});const v=["What trait do you admire most in someone you love?","What's the most spontaneous thing you've ever done?","What's a small thing that always makes you smile?","If you could relive one day, which would it be?","What's something you're still healing from?","What's a compliment you've never forgotten?","What do you think people notice first about you?","What's a fear you've overcome?","What's one thing you'd never compromise on?","How do you define success?","What's something you're looking forward to?","What's a tradition you hope to continue or start?","What do you value most in a friendship?","What's a moment you're proud of but don't talk about often?","What's something that feels like home to you?","What's a risk you're glad you took?","What's one thing you wish you could tell your younger self?","What kind of legacy do you want to leave?","What's something that always grounds you when life feels chaotic?","What's a dream you've had for as long as you can remember?"];let r=[],g=[],i=0;k(w,t=>{if(!t){alert("You must be logged in to participate. Redirecting to login."),window.location.href="/auth/login.html";return}const o=t.uid;let s=localStorage.getItem("woobieMatchID"),u=localStorage.getItem("woobieUsername");if(!s||!u){f(l(c,`users/${o}/currentMatch`)).then(d=>{const m=d.val();if(!m||!m.matchID||!m.username){alert("No match found. Please restart."),window.location.href="/name-picker/index.html";return}s=m.matchID,u=m.username,localStorage.setItem("woobieMatchID",s),localStorage.setItem("woobieUsername",u),C(o,s,u)}).catch(d=>{console.error("Error fetching match data:",d),alert("Error loading session. Please try again.")});return}C(o,s,u)});async function C(t,o,s){console.log(`[Tier2 INIT] MatchID: ${o}, UserID: ${t}, WoobieName: ${s}`);function u(e){const n=[...e];for(let a=n.length-1;a>0;a--){const b=Math.floor(Math.random()*(a+1));[n[a],n[b]]=[n[b],n[a]]}return n}const d=l(c,`matches/${o}/tier2Questions`),m=l(c,`matches/${o}/users`);try{const e=await f(d);if(e.exists())r=e.val(),console.log("Loaded randomized questions for tier2 from match:",o);else{const n=await f(m),a=Object.keys(n.val()||{});if(a.length>0&&a.sort()[0]===t)r=u(v).slice(0,12),await h(d,r),console.log("Generated new randomized questions for tier2:",o);else{console.log("Waiting for partner to generate tier2 questions...");let I=0;for(;I<10;){await new Promise(D=>setTimeout(D,500));const T=await f(d);if(T.exists()){r=T.val(),console.log("Loaded tier2 questions after waiting");break}I++}r.length===0&&(console.warn("Timeout waiting for questions, using fallback"),r=v.slice(0,12))}}}catch(e){console.error("Error loading tier2 questions:",e),r=v.slice(0,12)}const B=l(c,`users/${t}/currentMatch`);y(B,{stage:"tier2"});const W=l(c,`matches/${o}/tier2/${t}`),S=l(c,`matches/${o}/tier2`),q=l(c,`matches/${o}/tier2Rewards`),p=l(c,`matches/${o}/tier2Drafts/${t}`);try{if((await f(W)).exists()){console.log("[Tier2] User has already submitted answers, redirecting to send page"),window.location.href="/tier2/send.html";return}}catch(e){console.error("Error checking existing answers:",e)}try{const e=await f(p);if(e.exists()){const n=e.val();g=n.answers||[],i=n.currentIndex||0,console.log("[Tier2] Loaded partial draft from database:",{answerCount:g.length,currentIndex:i})}else console.log("[Tier2] No draft found in database, starting fresh")}catch(e){console.error("Error loading tier2 draft from database:",e)}function x(e){document.getElementById("question-number")&&(document.getElementById("question-number").textContent=`Question ${e+1} of ${r.length}`),document.getElementById("question-text")&&(document.getElementById("question-text").textContent=r[e]),document.getElementById("answer")&&(document.getElementById("answer").value=g[e]||"")}function j(){const e={answers:g,currentIndex:i,lastSaved:Date.now()};h(p,e).then(()=>{console.log("[Tier2] Saved draft to database:",{answerCount:g.length,currentIndex:i})}).catch(n=>{console.error("[Tier2] Error saving draft to database:",n)})}async function $(){try{await h(W,{answers:g,woobieName:s,timestamp:Date.now()}),console.log("Tier2 answers submitted successfully"),await h(p,null),console.log("Tier2 draft cleared from database"),await y(B,{stage:"tier2-answers-submitted"}),A()}catch(e){console.error("Error saving tier2 answers:",e),alert("Failed to save answers. Please try again.")}}function A(){M(S,e=>{const n=e.val()||{};Object.keys(n).length>=2?(R(S),window.location.href="/tier2/send.html"):(document.getElementById("question-block")&&(document.getElementById("question-block").style.display="none"),document.getElementById("completion-message")&&(document.getElementById("completion-message").style.display="block"))})}if(i>=r.length)$();else{x(i);const e=document.getElementById("submit-btn");e&&(e.onclick=()=>{const n=document.getElementById("answer");if(!n)return;const a=n.value.trim();a&&(g[i]=a,j(),i++,i<r.length?x(i):(document.getElementById("question-block")&&(document.getElementById("question-block").style.display="none"),document.getElementById("completion-message")&&(document.getElementById("completion-message").style.display="block"),$()))})}M(q,e=>{const n=e.val();n&&Object.keys(n).length>=2&&(R(q),window.location.href="/tier2/reveal.html")})}
