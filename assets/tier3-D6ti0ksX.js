const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/preload-helper-DX5QSOJm.js","assets/firebase-config-DqIMhm9h.js"])))=>i.map(i=>d[i]);
import{o as O,g as E,r as d,d as m,b as B,c as $,a as L,e as W,u as x,s as Y}from"./firebase-config-DqIMhm9h.js";/* empty css              */import{_ as U}from"./preload-helper-DX5QSOJm.js";import"./logout-C5vuDOMp.js";function Q(s){return s.replace(new RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),e=>`<span class="woobie-emoji">${e}</span>`)}const k=["What's a belief you held strongly that changed over time?","What's one thing you never get tired of talking about?","When have you felt the most brave?","How do you handle emotional pain?","What do you wish someone had told you earlier in life?","What kind of people do you feel safest around?","What's something you're currently working through internally?","When do you feel most vulnerable, and why?","What's a memory that always brings you comfort?","If your younger self met you now, what would they say?","What's a truth you've learned the hard way?","What's something you've forgiven yourself for?"];O(L,async s=>{if(!s){alert("You must be logged in to participate. Redirecting to login."),window.location.href="/auth/login.html";return}const e=s.uid;let n=localStorage.getItem("woobieMatchID"),i=localStorage.getItem("woobieUsername");if(!n||!i){const{update:t}=await U(async()=>{const{update:p}=await import("./preload-helper-DX5QSOJm.js").then(w=>w.i);return{update:p}},__vite__mapDeps([0,1])),y=(await E(d(m,`users/${e}/currentMatch`))).val();if(!y||!y.matchID||!y.username){alert("No match found. Please restart."),window.location.href="/name-picker/index.html";return}n=y.matchID,i=y.username,localStorage.setItem("woobieMatchID",n),localStorage.setItem("woobieUsername",i)}const g=d(m,`matches/${n}/tier3/${e}`),r=d(m,`matches/${n}/tier3`),l=d(m,`matches/${n}/tier3Votes/${e}`),a=d(m,`matches/${n}/tier3Votes`),M=d(m,`matches/${n}/tier3Drafts/${e}`),v=document.getElementById("question-block"),f=document.getElementById("completion-message"),j=document.getElementById("review-section"),R=document.getElementById("vote-section"),C=document.getElementById("vote-yes"),D=document.getElementById("vote-no"),V=document.getElementById("vote-waiting");function T(){C.style.display="none",D.style.display="none",V.style.display="block",$(a,t=>{const o=t.val();if(!o||Object.keys(o).length<2)return;const y=Object.values(o).every(I=>I===!0);W(a);const p=d(m,`users/${e}/currentMatch`),w=d(m,`users/${e}`);y?Promise.all([x(p,{stage:"chatroom"}),x(w,{stage:"chatroom"})]).then(()=>{window.location.href="/chat/index.html"}):Promise.all([x(p,{stage:"goodbye-tier3"}),x(w,{stage:"goodbye-tier3"})]).then(()=>{window.location.href="/goodbye.html"})})}C.onclick=()=>{B(l,!0).then(T)},D.onclick=()=>{const t=prompt("If you're sure you want to end the match, type 'Goodbye' and press OK.");(t==null?void 0:t.trim().toLowerCase())==="goodbye"&&B(l,!1).then(T)};let h=[],u=0;if((await E(g)).exists()){console.log("[Tier3] User has already submitted answers, checking for partner"),v.style.display="none",f.style.display="block";const o=(await E(r)).val();o&&Object.keys(o).length>=2?(f.style.display="none",F(o),(await E(l)).exists()&&(console.log("[Tier3] User has already voted, showing waiting message"),T())):N();return}const P=await E(M);if(P.exists()){const t=P.val();h=t.answers||[],u=t.currentIndex||0,console.log("[Tier3] Loaded partial draft from database:",{answerCount:h.length,currentIndex:u})}else console.log("[Tier3] No draft found in database, starting fresh");let c=document.getElementById("waiting-message");c||(c=document.createElement("div"),c.id="waiting-message",c.innerHTML="<p>Waiting for your match to finish answering...</p>",c.style.color="#33ff33",c.style.textAlign="center",c.style.marginTop="2rem",c.style.display="none",v.parentNode.appendChild(c));function _(){const t={answers:h,currentIndex:u,lastSaved:Date.now()};B(M,t).then(()=>{console.log("[Tier3] Saved draft to database:",{answerCount:h.length,currentIndex:u})}).catch(o=>{console.error("[Tier3] Error saving draft to database:",o)})}function A(){if(u>=k.length){v.style.display="none",f.style.display="block",q();return}document.getElementById("question-number").textContent=`Question ${u+1} of ${k.length}`,document.getElementById("question-text").textContent=k[u],document.getElementById("answer").value=h[u]||""}document.getElementById("submit-btn").onclick=()=>{const t=document.getElementById("answer").value.trim();t&&(h[u]=t,_(),u++,A())};async function q(){await B(g,{answers:h,timestamp:Date.now(),woobieName:i}),await B(M,null),console.log("Tier3 draft cleared from database"),$(r,t=>{const o=t.val();o&&Object.keys(o).length>=2?(f.style.display="none",c.style.display="none",S(o)):(v.style.display="none",f.style.display="none",c.style.display="block")})}function F(t){S(t)}function N(){v.style.display="none",f.style.display="block",$(r,t=>{const o=t.val();o&&Object.keys(o).length>=2&&(f.style.display="none",W(r),S(o))})}function S(t){var w;const o=Object.keys(t).find(I=>I!==e);if(!o)return;const y=h.length>0?h:((w=t[e])==null?void 0:w.answers)||[];let p="<h3>ðŸ“˜ Tier 3 Answers</h3>";k.forEach((I,H)=>{p+=`
        <details><summary><strong>${I}</strong></summary>
        <p><strong>You:</strong> ${y[H]||""}</p>
        <p><strong>Your Match:</strong> ${t[o].answers[H]||""}</p>
        </details>`}),j.innerHTML=Q(p),j.style.display="block",R.style.display="block"}A()});function b(s){return s.replace(new RegExp("(\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F)","gu"),e=>`<span class="woobie-emoji">${e}</span>`)}function G(){navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&document.querySelectorAll(".woobie-emoji").forEach(e=>{e.style.setProperty("font-family","OpenMoji, monospace","important"),e.style.setProperty("color","#ffb000","important"),e.style.setProperty("text-shadow","0 0 10px #ffb000, 0 0 15px #ff9900","important"),e.style.setProperty("display","inline-block","important"),e.style.setProperty("font-weight","normal","important"),e.style.setProperty("font-style","normal","important")})}document.addEventListener("DOMContentLoaded",()=>{const s=document.querySelector("h1");s&&(s.innerHTML=b(s.textContent));const e=document.getElementById("logout-button");e&&(e.innerHTML=b(e.textContent));const n=document.getElementById("vote-yes"),i=document.getElementById("vote-no");n&&(n.innerHTML=b(n.textContent)),i&&(i.innerHTML=b(i.textContent));const g=document.getElementById("close-story");g&&(g.innerHTML=b(g.textContent));const r=document.querySelector("#our-story-modal h2");r&&(r.innerHTML=b(r.textContent));const l=document.getElementById("our-story-button");l&&(l.innerHTML=b(l.textContent));const a=document.getElementById("submit-btn");a&&a.textContent==="Next"&&(a.innerHTML='Next <span class="woobie-emoji">â†’</span>'),setTimeout(G,100)});const K=document.getElementById("logout-button");K.onclick=async()=>{if(confirm("Are you sure you want to log out? You'll lose your place unless you're logged in.")){try{await Y(L)}catch(e){console.warn("Firebase sign-out failed:",e)}localStorage.clear(),sessionStorage.clear(),window.location.href="/resume.html"}};O(L,async s=>{if(!s){alert("You must be logged in to participate. Redirecting to login."),window.location.href="/auth/login.html";return}const e=s.uid,n=localStorage.getItem("woobieMatchID");if(!n){alert("Missing Match ID. Please restart."),window.location.href="/name-picker/index.html";return}await x(d(m,`users/${e}/currentMatch`),{stage:"tier3"}),document.getElementById("vote-yes"),document.getElementById("vote-no"),document.getElementById("vote-waiting"),d(m,`matches/${n}/tier3Votes/${e}`),d(m,`matches/${n}/tier3Votes`);const i=document.getElementById("our-story-button"),g=document.getElementById("close-story"),r=document.getElementById("story-content"),l=document.getElementById("our-story-modal");i&&l&&r&&g&&(i.onclick=async()=>{l.style.display="block",r.innerHTML="<p>Loading...</p>";try{const a=document.createElement("iframe");a.src="/shared/history.html",a.style.width="100%",a.style.height="70vh",a.style.border="1px solid #33ff33",a.style.backgroundColor="black",r.innerHTML="",r.appendChild(a)}catch(a){console.error(a),r.innerHTML='<p style="color:red;">Error loading story.</p>'}},g.onclick=()=>{l.style.display="none"})});
